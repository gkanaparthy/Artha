#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Block dangerous Prisma commands from being committed
if git diff --cached --name-only | grep -qE '\.ts$|\.js$|\.sh$'; then
  if git diff --cached | grep -qE 'prisma (db push --force-reset|migrate reset)'; then
    echo "❌ ERROR: Attempting to commit code with dangerous Prisma reset command!"
    echo "   Commands like 'prisma db push --force-reset' are FORBIDDEN."
    echo "   Please remove this command before committing."
    exit 1
  fi
fi

# Scan for accidentally committed secrets
if git diff --cached | grep -qE '(SNAPTRADE_CONSUMER_KEY|SNAPTRADE_CLIENT_ID|AUTH_SECRET|DATABASE_URL|cmkhnusy40000ie5ulwlcys4q|cmkhti6uu0000111l52rekv5x|wJEiuq|WELLTHY-PRODUCTS)'; then
  echo "❌ ERROR: Potential secret or sensitive ID detected in commit!"
  echo "   Found hardcoded API key, user ID, or credential."
  echo "   Please use environment variables instead."
  echo ""
  echo "   Tip: Use process.env.VARIABLE_NAME instead of hardcoding secrets."
  exit 1
fi
